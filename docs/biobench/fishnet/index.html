<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1">
<meta name="generator" content="pdoc3 0.11.6">
<title>biobench.fishnet API documentation</title>
<meta name="description" content="FishNet: Fish Recognition, Detection, and Functional Traits Prediction …">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/13.0.0/sanitize.min.css" integrity="sha512-y1dtMcuvtTMJc1yPgEqF0ZjQbhnc/bFhyvIyVNb9Zk5mIGtqVaAB1Ttl28su8AvFMOY0EwRbAe+HCLqj6W7/KA==" crossorigin>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/13.0.0/typography.min.css" integrity="sha512-Y1DYSb995BAfxobCkKepB1BqJJTPrOp3zPL74AWFugHHmmdcvO+C48WLrUOlhGMc0QG7AE3f7gmvvcrmX2fDoA==" crossorigin>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/default.min.css" crossorigin>
<style>:root{--highlight-color:#fe9}.flex{display:flex !important}body{line-height:1.5em}#content{padding:20px}#sidebar{padding:1.5em;overflow:hidden}#sidebar > *:last-child{margin-bottom:2cm}.http-server-breadcrumbs{font-size:130%;margin:0 0 15px 0}#footer{font-size:.75em;padding:5px 30px;border-top:1px solid #ddd;text-align:right}#footer p{margin:0 0 0 1em;display:inline-block}#footer p:last-child{margin-right:30px}h1,h2,h3,h4,h5{font-weight:300}h1{font-size:2.5em;line-height:1.1em}h2{font-size:1.75em;margin:2em 0 .50em 0}h3{font-size:1.4em;margin:1.6em 0 .7em 0}h4{margin:0;font-size:105%}h1:target,h2:target,h3:target,h4:target,h5:target,h6:target{background:var(--highlight-color);padding:.2em 0}a{color:#058;text-decoration:none;transition:color .2s ease-in-out}a:visited{color:#503}a:hover{color:#b62}.title code{font-weight:bold}h2[id^="header-"]{margin-top:2em}.ident{color:#900;font-weight:bold}pre code{font-size:.8em;line-height:1.4em;padding:1em;display:block}code{background:#f3f3f3;font-family:"DejaVu Sans Mono",monospace;padding:1px 4px;overflow-wrap:break-word}h1 code{background:transparent}pre{border-top:1px solid #ccc;border-bottom:1px solid #ccc;margin:1em 0}#http-server-module-list{display:flex;flex-flow:column}#http-server-module-list div{display:flex}#http-server-module-list dt{min-width:10%}#http-server-module-list p{margin-top:0}.toc ul,#index{list-style-type:none;margin:0;padding:0}#index code{background:transparent}#index h3{border-bottom:1px solid #ddd}#index ul{padding:0}#index h4{margin-top:.6em;font-weight:bold}@media (min-width:200ex){#index .two-column{column-count:2}}@media (min-width:300ex){#index .two-column{column-count:3}}dl{margin-bottom:2em}dl dl:last-child{margin-bottom:4em}dd{margin:0 0 1em 3em}#header-classes + dl > dd{margin-bottom:3em}dd dd{margin-left:2em}dd p{margin:10px 0}.name{background:#eee;font-size:.85em;padding:5px 10px;display:inline-block;min-width:40%}.name:hover{background:#e0e0e0}dt:target .name{background:var(--highlight-color)}.name > span:first-child{white-space:nowrap}.name.class > span:nth-child(2){margin-left:.4em}.inherited{color:#999;border-left:5px solid #eee;padding-left:1em}.inheritance em{font-style:normal;font-weight:bold}.desc h2{font-weight:400;font-size:1.25em}.desc h3{font-size:1em}.desc dt code{background:inherit}.source > summary,.git-link-div{color:#666;text-align:right;font-weight:400;font-size:.8em;text-transform:uppercase}.source summary > *{white-space:nowrap;cursor:pointer}.git-link{color:inherit;margin-left:1em}.source pre{max-height:500px;overflow:auto;margin:0}.source pre code{font-size:12px;overflow:visible;min-width:max-content}.hlist{list-style:none}.hlist li{display:inline}.hlist li:after{content:',\2002'}.hlist li:last-child:after{content:none}.hlist .hlist{display:inline;padding-left:1em}img{max-width:100%}td{padding:0 .5em}.admonition{padding:.1em 1em;margin:1em 0}.admonition-title{font-weight:bold}.admonition.note,.admonition.info,.admonition.important{background:#aef}.admonition.todo,.admonition.versionadded,.admonition.tip,.admonition.hint{background:#dfd}.admonition.warning,.admonition.versionchanged,.admonition.deprecated{background:#fd4}.admonition.error,.admonition.danger,.admonition.caution{background:lightpink}</style>
<style media="screen and (min-width: 700px)">@media screen and (min-width:700px){#sidebar{width:30%;height:100vh;overflow:auto;position:sticky;top:0}#content{width:70%;max-width:100ch;padding:3em 4em;border-left:1px solid #ddd}pre code{font-size:1em}.name{font-size:1em}main{display:flex;flex-direction:row-reverse;justify-content:flex-end}.toc ul ul,#index ul ul{padding-left:1em}.toc > ul > li{margin-top:.5em}}</style>
<style media="print">@media print{#sidebar h1{page-break-before:always}.source{display:none}}@media print{*{background:transparent !important;color:#000 !important;box-shadow:none !important;text-shadow:none !important}a[href]:after{content:" (" attr(href) ")";font-size:90%}a[href][title]:after{content:none}abbr[title]:after{content:" (" attr(title) ")"}.ir a:after,a[href^="javascript:"]:after,a[href^="#"]:after{content:""}pre,blockquote{border:1px solid #999;page-break-inside:avoid}thead{display:table-header-group}tr,img{page-break-inside:avoid}img{max-width:100% !important}@page{margin:0.5cm}p,h2,h3{orphans:3;widows:3}h1,h2,h3,h4,h5,h6{page-break-after:avoid}}</style>
<script type="text/x-mathjax-config">MathJax.Hub.Config({ tex2jax: { inlineMath: [ ['$','$'], ["\\(","\\)"] ], processEscapes: true } });</script>
<script async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS_CHTML" integrity="sha256-kZafAc6mZvK3W3v1pHOcUix30OHQN6pU/NO2oFkqZVw=" crossorigin></script>
<script defer src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js" integrity="sha512-D9gUyxqja7hBtkWpPWGt9wfbfaMGVt9gnyCvYa+jojwwPHLCzUm5i8rpk7vD7wNee9bA35eYIjobYPaQuKS1MQ==" crossorigin></script>
<script>window.addEventListener('DOMContentLoaded', () => {
hljs.configure({languages: ['bash', 'css', 'diff', 'graphql', 'ini', 'javascript', 'json', 'plaintext', 'python', 'python-repl', 'rust', 'shell', 'sql', 'typescript', 'xml', 'yaml']});
hljs.highlightAll();
/* Collapse source docstrings */
setTimeout(() => {
[...document.querySelectorAll('.hljs.language-python > .hljs-string')]
.filter(el => el.innerHTML.length > 200 && ['"""', "'''"].includes(el.innerHTML.substring(0, 3)))
.forEach(el => {
let d = document.createElement('details');
d.classList.add('hljs-string');
d.innerHTML = '<summary>"""</summary>' + el.innerHTML.substring(3);
el.replaceWith(d);
});
}, 100);
})</script>
</head>
<body>
<main>
<article id="content">
<header>
<h1 class="title">Module <code>biobench.fishnet</code></h1>
</header>
<section id="section-intro">
<h1 id="fishnet-fish-recognition-detection-and-functional-traits-prediction">FishNet: Fish Recognition, Detection, and Functional Traits Prediction</h1>
<p>FishNet (<a href="https://openaccess.thecvf.com/content/ICCV2023/papers/Khan_FishNet_A_Large-scale_Dataset_and_Benchmark_for_Fish_Recognition_Detection_ICCV_2023_paper.pdf">paper</a>, <a href="https://github.com/faixan-khan/FishNet">code</a>) is a large-scale diverse dataset containing 94,532 images from 17,357 aquatic species.
It contains three benchmarks: fish classification, fish detection, and functional traits prediction.</p>
<p>We mainly focus on the third task.
We train an two-layer MLP on the visual features extracted by different model backbones to predict the presence or absence of 9 different traits.</p>
<p>If you use this evaluation, be sure to cite the original work:</p>
<pre><code>@InProceedings{Khan_2023_ICCV,
    author    = {Khan, Faizan Farooq and Li, Xiang and Temple, Andrew J. and Elhoseiny, Mohamed},
    title     = {FishNet: A Large-scale Dataset and Benchmark for Fish Recognition, Detection, and Functional Trait Prediction},
    booktitle = {Proceedings of the IEEE/CVF International Conference on Computer Vision (ICCV)},
    month     = {October},
    year      = {2023},
    pages     = {20496-20506}
}
</code></pre>
<p>This task was contributed by <a href="https://vimar-gu.github.io/">Jianyang Gu</a>.</p>
</section>
<section>
<h2 class="section-title" id="header-submodules">Sub-modules</h2>
<dl>
<dt><code class="name"><a title="biobench.fishnet.download" href="download.html">biobench.fishnet.download</a></code></dt>
<dd>
<div class="desc"><p>A script to download the FishNet dataset …</p></div>
</dd>
</dl>
</section>
<section>
</section>
<section>
<h2 class="section-title" id="header-functions">Functions</h2>
<dl>
<dt id="biobench.fishnet.benchmark"><code class="name flex">
<span>def <span class="ident">benchmark</span></span>(<span>cfg: <a title="biobench.config.Experiment" href="../config.html#biobench.config.Experiment">Experiment</a>) ‑> tuple[<a title="biobench.config.Model" href="../config.html#biobench.config.Model">Model</a>, <a title="biobench.reporting.Report" href="../reporting.html#biobench.reporting.Report">Report</a>]</span>
</code></dt>
<dd>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def benchmark(cfg: config.Experiment) -&gt; tuple[config.Model, reporting.Report]:
    &#34;&#34;&#34;
    The FishNet benchmark.
    &#34;&#34;&#34;
    # 1. Load model.
    backbone = registry.load_vision_backbone(cfg.model)

    # 2. Get features.
    train_dataset = get_features(args, backbone, is_train=True)
    test_dataset = get_features(args, backbone, is_train=False)

    # 3. Set up classifier.
    classifier = init_classifier(train_dataset.dim).to(args.device)

    # 4. Load datasets for classifier.
    train_loader = torch.utils.data.DataLoader(
        train_dataset, batch_size=args.batch_size, shuffle=True
    )
    test_loader = torch.utils.data.DataLoader(
        test_dataset, batch_size=args.batch_size, shuffle=False
    )
    optimizer = torch.optim.Adam(classifier.parameters(), lr=args.learning_rate)
    criterion = torch.nn.BCEWithLogitsLoss()
    scheduler = torch.optim.lr_scheduler.StepLR(optimizer, step_size=20, gamma=0.5)

    # 5. Fit the classifier.
    for epoch in range(args.n_epochs):
        total = 2 if args.debug else len(train_loader)
        it = iter(train_loader)
        for b in range(total):
            features, labels, _ = next(it)
            features = features.to(args.device)
            labels = labels.to(args.device, dtype=torch.float)
            output = classifier(features)
            loss = criterion(output, labels)

            optimizer.zero_grad()
            loss.backward()
            optimizer.step()

        scheduler.step()

        # Evaluate the classifier.
        if (epoch + 1) % args.log_every == 0:
            examples = evaluate(args, classifier, test_loader)
            score = calc_macro_f1(examples)
            logger.info(&#34;Epoch %d/%d: %.3f&#34;, epoch + 1, args.n_epochs, score)

    return cfg.model, reporting.Report(
        &#34;FishNet&#34;, examples, calc_mean_score=calc_macro_f1
    )</code></pre>
</details>
<div class="desc"><p>The FishNet benchmark.</p></div>
</dd>
<dt id="biobench.fishnet.calc_macro_f1"><code class="name flex">
<span>def <span class="ident">calc_macro_f1</span></span>(<span>preds: list[<a title="biobench.reporting.Prediction" href="../reporting.html#biobench.reporting.Prediction">Prediction</a>]) ‑> float</span>
</code></dt>
<dd>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def calc_macro_f1(preds: list[reporting.Prediction]) -&gt; float:
    &#34;&#34;&#34;
    Calculate the macro-averaged F1 score across all fish trait predictions.

    For each fish image, we predict 9 binary traits:

    1. Feeding Path (benthic/pelagic)
    2. Tropical habitat (yes/no)
    3. Temperate habitat (yes/no)
    4. Subtropical habitat (yes/no)
    5. Boreal habitat (yes/no)
    6. Polar habitat (yes/no)
    7. Freshwater habitat (yes/no)
    8. Saltwater habitat (yes/no)
    9. Brackish water habitat (yes/no)

    The macro-averaging:

    1. Calculates an F1 score for each trait independently
    2. Takes the unweighted mean of these 9 F1 scores

    This ensures each trait contributes equally to the final score, regardless of class imbalance in the dataset (e.g., if there are many more tropical fish than brackish water fish).

    Args:
        preds: List of predictions, each containing:
            - info[&#34;y_pred&#34;]: List of 9 binary predictions
            - info[&#34;y_true&#34;]: List of 9 binary ground truth values

    Returns:
        The macro-averaged F1 score across all 9 traits
    &#34;&#34;&#34;
    y_pred = np.array([pred.info[&#34;y_pred&#34;] for pred in preds])
    y_true = np.array([pred.info[&#34;y_true&#34;] for pred in preds])
    return sklearn.metrics.f1_score(
        y_true, y_pred, average=&#34;macro&#34;, labels=np.unique(y_true)
    )</code></pre>
</details>
<div class="desc"><p>Calculate the macro-averaged F1 score across all fish trait predictions.</p>
<p>For each fish image, we predict 9 binary traits:</p>
<ol>
<li>Feeding Path (benthic/pelagic)</li>
<li>Tropical habitat (yes/no)</li>
<li>Temperate habitat (yes/no)</li>
<li>Subtropical habitat (yes/no)</li>
<li>Boreal habitat (yes/no)</li>
<li>Polar habitat (yes/no)</li>
<li>Freshwater habitat (yes/no)</li>
<li>Saltwater habitat (yes/no)</li>
<li>Brackish water habitat (yes/no)</li>
</ol>
<p>The macro-averaging:</p>
<ol>
<li>Calculates an F1 score for each trait independently</li>
<li>Takes the unweighted mean of these 9 F1 scores</li>
</ol>
<p>This ensures each trait contributes equally to the final score, regardless of class imbalance in the dataset (e.g., if there are many more tropical fish than brackish water fish).</p>
<h2 id="args">Args</h2>
<dl>
<dt><strong><code>preds</code></strong></dt>
<dd>List of predictions, each containing:
- info["y_pred"]: List of 9 binary predictions
- info["y_true"]: List of 9 binary ground truth values</dd>
</dl>
<h2 id="returns">Returns</h2>
<p>The macro-averaged F1 score across all 9 traits</p></div>
</dd>
<dt id="biobench.fishnet.evaluate"><code class="name flex">
<span>def <span class="ident">evaluate</span></span>(<span>args: <a title="biobench.fishnet.Args" href="#biobench.fishnet.Args">Args</a>,<br>classifier: torch.nn.modules.module.Module,<br>dataloader) ‑> list[<a title="biobench.reporting.Prediction" href="../reporting.html#biobench.reporting.Prediction">Prediction</a>]</span>
</code></dt>
<dd>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def evaluate(
    args: Args, classifier: torch.nn.Module, dataloader
) -&gt; list[reporting.Prediction]:
    &#34;&#34;&#34;
    Evaluates the trained classifier on a test split.

    Returns:
        a list of Examples.
    &#34;&#34;&#34;
    total = 2 if args.debug else len(dataloader)
    it = iter(dataloader)
    examples = []
    for b in range(total):
        features, labels, ids = next(it)
        features = features.to(args.device)
        labels = labels.numpy()
        with torch.no_grad():
            pred_logits = classifier(features)
        pred_logits = (pred_logits &gt; args.threshold).cpu().numpy()
        for id, pred, true in zip(ids, pred_logits, labels):
            example = reporting.Prediction(
                id,
                float((pred == true).all()),
                {&#34;y_pred&#34;: pred.tolist(), &#34;y_true&#34;: true.tolist()},
            )
            examples.append(example)

    return examples</code></pre>
</details>
<div class="desc"><p>Evaluates the trained classifier on a test split.</p>
<h2 id="returns">Returns</h2>
<p>a list of Examples.</p></div>
</dd>
<dt id="biobench.fishnet.get_features"><code class="name flex">
<span>def <span class="ident">get_features</span></span>(<span>args: <a title="biobench.fishnet.Args" href="#biobench.fishnet.Args">Args</a>,<br>backbone: <a title="biobench.registry.VisionBackbone" href="../registry.html#biobench.registry.VisionBackbone">VisionBackbone</a>,<br>*,<br>is_train: bool) ‑> <a title="biobench.fishnet.Features" href="#biobench.fishnet.Features">Features</a></span>
</code></dt>
<dd>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def get_features(
    args: Args, backbone: registry.VisionBackbone, *, is_train: bool
) -&gt; Features:
    &#34;&#34;&#34;Extract visual features.&#34;&#34;&#34;
    if not os.path.isdir(args.data):
        msg = f&#34;Path &#39;{args.data}&#39; doesn&#39;t exist. Did you download the FishNet dataset? See the docstring at the top of this file for instructions. If you did download it, pass the path with &#39;--fishnet-args.data&#39;; see --help for more.&#34;
        raise ValueError(msg)

    img_transform = backbone.make_img_transform()
    backbone = torch.compile(backbone.to(args.device))

    file = &#34;train.csv&#34; if is_train else &#34;test.csv&#34;
    dataset = ImageDataset(args.data, file, transform=img_transform)
    dataloader = torch.utils.data.DataLoader(
        dataset,
        batch_size=args.batch_size,
        num_workers=args.n_workers,
        shuffle=True,
    )

    all_features, all_labels, all_ids = [], [], []

    if args.debug:
        n = args.batch_size * 2
        total = 2  # 2 batches
    elif is_train and args.n_train &gt;= 0:
        n = args.n_train
        total = n // args.batch_size + 1
    else:
        n = len(dataset)
        total = len(dataloader)

    it = iter(dataloader)
    for b in helpers.progress(range(total), every=args.log_every, desc=file):
        images, labels, ids = next(it)
        images = images.to(args.device)

        features = backbone.img_encode(images).img_features
        all_features.append(features.cpu())
        all_labels.append(labels)

        all_ids.extend(ids)

    # Keep the Tensor data type for subsequent training
    all_features = torch.cat(all_features, dim=0)[:n]
    all_labels = torch.cat(all_labels, dim=0)[:n]
    all_ids = all_ids[:n]

    return Features(all_features, all_labels, all_ids)</code></pre>
</details>
<div class="desc"><p>Extract visual features.</p></div>
</dd>
<dt id="biobench.fishnet.init_classifier"><code class="name flex">
<span>def <span class="ident">init_classifier</span></span>(<span>input_dim: int) ‑> torch.nn.modules.module.Module</span>
</code></dt>
<dd>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def init_classifier(input_dim: int) -&gt; torch.nn.Module:
    &#34;&#34;&#34;A simple MLP classifier consistent with the design in FishNet.&#34;&#34;&#34;
    return torch.nn.Sequential(
        torch.nn.Linear(input_dim, 512),
        torch.nn.Dropout(0.5),
        torch.nn.Linear(512, 9),
    )</code></pre>
</details>
<div class="desc"><p>A simple MLP classifier consistent with the design in FishNet.</p></div>
</dd>
</dl>
</section>
<section>
<h2 class="section-title" id="header-classes">Classes</h2>
<dl>
<dt id="biobench.fishnet.Args"><code class="flex name class">
<span>class <span class="ident">Args</span></span>
<span>(</span><span>data: str = '',<br>batch_size: int = 256,<br>n_workers: int = 4,<br>log_every: int = 10,<br>n_epochs: int = 100,<br>learning_rate: float = 0.0005,<br>threshold: float = 0.5,<br>seed: int = 42,<br>device: str = 'cuda',<br>debug: bool = False,<br>n_train: int = -1)</span>
</code></dt>
<dd>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@beartype.beartype
@dataclasses.dataclass(frozen=True)
class Args:
    &#34;&#34;&#34;FishNet task arguments.&#34;&#34;&#34;

    data: str = &#34;&#34;
    &#34;&#34;&#34;dataset directory; where you downloaded this task&#39;s data to.&#34;&#34;&#34;
    batch_size: int = 256
    &#34;&#34;&#34;batch size for computer vision model.&#34;&#34;&#34;
    n_workers: int = 4
    &#34;&#34;&#34;number of dataloader worker processes.&#34;&#34;&#34;
    log_every: int = 10
    &#34;&#34;&#34;how often (number of epochs) to log progress.&#34;&#34;&#34;
    n_epochs: int = 100
    &#34;&#34;&#34;How many epochs to train the MLP classifier.&#34;&#34;&#34;
    learning_rate: float = 5e-4
    &#34;&#34;&#34;The learning rate for training the MLP classifier.&#34;&#34;&#34;
    threshold: float = 0.5
    &#34;&#34;&#34;The threshold to predict &#34;presence&#34; rather than &#34;absence&#34;.&#34;&#34;&#34;
    seed: int = 42
    &#34;&#34;&#34;random seed.&#34;&#34;&#34;

    # Computed at runtime.
    device: str = &#34;cuda&#34;
    &#34;&#34;&#34;(computed at runtime) which kind of accelerator to use.&#34;&#34;&#34;
    debug: bool = False
    &#34;&#34;&#34;(computed at runtime) whether to run in debug mode.&#34;&#34;&#34;
    n_train: int = -1
    &#34;&#34;&#34;Number of maximum training samples. Negative number means use all of them.&#34;&#34;&#34;</code></pre>
</details>
<div class="desc"><p>FishNet task arguments.</p></div>
<h3>Instance variables</h3>
<dl>
<dt id="biobench.fishnet.Args.batch_size"><code class="name">var <span class="ident">batch_size</span> : int</code></dt>
<dd>
<div class="desc"><p>batch size for computer vision model.</p></div>
</dd>
<dt id="biobench.fishnet.Args.data"><code class="name">var <span class="ident">data</span> : str</code></dt>
<dd>
<div class="desc"><p>dataset directory; where you downloaded this task's data to.</p></div>
</dd>
<dt id="biobench.fishnet.Args.debug"><code class="name">var <span class="ident">debug</span> : bool</code></dt>
<dd>
<div class="desc"><p>(computed at runtime) whether to run in debug mode.</p></div>
</dd>
<dt id="biobench.fishnet.Args.device"><code class="name">var <span class="ident">device</span> : str</code></dt>
<dd>
<div class="desc"><p>(computed at runtime) which kind of accelerator to use.</p></div>
</dd>
<dt id="biobench.fishnet.Args.learning_rate"><code class="name">var <span class="ident">learning_rate</span> : float</code></dt>
<dd>
<div class="desc"><p>The learning rate for training the MLP classifier.</p></div>
</dd>
<dt id="biobench.fishnet.Args.log_every"><code class="name">var <span class="ident">log_every</span> : int</code></dt>
<dd>
<div class="desc"><p>how often (number of epochs) to log progress.</p></div>
</dd>
<dt id="biobench.fishnet.Args.n_epochs"><code class="name">var <span class="ident">n_epochs</span> : int</code></dt>
<dd>
<div class="desc"><p>How many epochs to train the MLP classifier.</p></div>
</dd>
<dt id="biobench.fishnet.Args.n_train"><code class="name">var <span class="ident">n_train</span> : int</code></dt>
<dd>
<div class="desc"><p>Number of maximum training samples. Negative number means use all of them.</p></div>
</dd>
<dt id="biobench.fishnet.Args.n_workers"><code class="name">var <span class="ident">n_workers</span> : int</code></dt>
<dd>
<div class="desc"><p>number of dataloader worker processes.</p></div>
</dd>
<dt id="biobench.fishnet.Args.seed"><code class="name">var <span class="ident">seed</span> : int</code></dt>
<dd>
<div class="desc"><p>random seed.</p></div>
</dd>
<dt id="biobench.fishnet.Args.threshold"><code class="name">var <span class="ident">threshold</span> : float</code></dt>
<dd>
<div class="desc"><p>The threshold to predict "presence" rather than "absence".</p></div>
</dd>
</dl>
</dd>
<dt id="biobench.fishnet.Features"><code class="flex name class">
<span>class <span class="ident">Features</span></span>
<span>(</span><span>x: jaxtyping.Float[Tensor, 'n dim'],<br>y: jaxtyping.Int[Tensor, 'n n_classes'],<br>ids: list[str])</span>
</code></dt>
<dd>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@jaxtyped(typechecker=beartype.beartype)
class Features(torch.utils.data.Dataset):
    &#34;&#34;&#34;
    A dataset of learned features (dense vectors).
    &#34;&#34;&#34;

    x: Float[Tensor, &#34; n dim&#34;]
    &#34;&#34;&#34;Dense feature vectors from a vision backbone.&#34;&#34;&#34;
    y: Int[Tensor, &#34; n 9&#34;]
    &#34;&#34;&#34;0/1 labels of absence/presence of 9 different traits.&#34;&#34;&#34;
    ids: list[str]
    &#34;&#34;&#34;Image ids.&#34;&#34;&#34;

    def __init__(
        self,
        x: Float[Tensor, &#34; n dim&#34;],
        y: Int[Tensor, &#34; n n_classes&#34;],
        ids: list[str],
    ):
        self.x = x
        self.y = y
        self.ids = ids

    @property
    def dim(self) -&gt; int:
        &#34;&#34;&#34;Dimension of the dense feature vectors.&#34;&#34;&#34;
        _, dim = self.x.shape
        return dim

    def __len__(self) -&gt; int:
        return len(self.x)

    def __getitem__(
        self, index
    ) -&gt; tuple[Float[Tensor, &#34; dim&#34;], Int[Tensor, &#34; n_classes&#34;], str]:
        return self.x[index], self.y[index], self.ids[index]</code></pre>
</details>
<div class="desc"><p>A dataset of learned features (dense vectors).</p></div>
<h3>Ancestors</h3>
<ul class="hlist">
<li>torch.utils.data.dataset.Dataset</li>
<li>typing.Generic</li>
</ul>
<h3>Class variables</h3>
<dl>
<dt id="biobench.fishnet.Features.ids"><code class="name">var <span class="ident">ids</span> : list[str]</code></dt>
<dd>
<div class="desc"><p>Image ids.</p></div>
</dd>
<dt id="biobench.fishnet.Features.x"><code class="name">var <span class="ident">x</span> : jaxtyping.Float[Tensor, 'n dim']</code></dt>
<dd>
<div class="desc"><p>Dense feature vectors from a vision backbone.</p></div>
</dd>
<dt id="biobench.fishnet.Features.y"><code class="name">var <span class="ident">y</span> : jaxtyping.Int[Tensor, 'n 9']</code></dt>
<dd>
<div class="desc"><p>0/1 labels of absence/presence of 9 different traits.</p></div>
</dd>
</dl>
<h3>Instance variables</h3>
<dl>
<dt id="biobench.fishnet.Features.dim"><code class="name">prop <span class="ident">dim</span> : int</code></dt>
<dd>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@property
def dim(self) -&gt; int:
    &#34;&#34;&#34;Dimension of the dense feature vectors.&#34;&#34;&#34;
    _, dim = self.x.shape
    return dim</code></pre>
</details>
<div class="desc"><p>Dimension of the dense feature vectors.</p></div>
</dd>
</dl>
</dd>
<dt id="biobench.fishnet.ImageDataset"><code class="flex name class">
<span>class <span class="ident">ImageDataset</span></span>
<span>(</span><span>root_dir: str, csv_file: str, transform)</span>
</code></dt>
<dd>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@jaxtyped(typechecker=beartype.beartype)
class ImageDataset(torch.utils.data.Dataset):
    &#34;&#34;&#34;
    A dataset for CV+ML that loads the required attribute labels.
    &#34;&#34;&#34;

    def __init__(self, root_dir: str, csv_file: str, transform):
        self.root_dir = root_dir
        self.csv_file = os.path.join(self.root_dir, csv_file)
        self.df = pl.read_csv(self.csv_file).with_row_index()
        self.all_columns = [
            &#34;FeedingPath&#34;,
            &#34;Tropical&#34;,
            &#34;Temperate&#34;,
            &#34;Subtropical&#34;,
            &#34;Boreal&#34;,
            &#34;Polar&#34;,
            &#34;freshwater&#34;,
            &#34;saltwater&#34;,
            &#34;brackish&#34;,
        ]
        for col in self.all_columns:
            self.df = self.df.filter(self.df[col].is_not_null())
        self.transform = transform

        # Corresponding column indices
        self.image_col = 4
        self.folder_col = 13
        self.label_cols = [15, 16, 17, 18, 19, 20, 21, 22, 23]
        logger.info(&#34;csv file: %s has %d item.&#34;, csv_file, len(self.df))

    def __getitem__(
        self, index: int
    ) -&gt; tuple[Float[Tensor, &#34;3 width height&#34;], Int[Tensor, &#34;9&#34;], str]:
        row_data = self.df.row(index)
        image_name = row_data[self.image_col]
        image_name = image_name.split(&#34;/&#34;)[-1]
        folder = row_data[self.folder_col]
        image_path = os.path.join(self.root_dir, &#34;Image_Library&#34;, folder, image_name)
        image = Image.open(image_path)

        # Extract the required attribute labels.
        label = []
        for col in self.label_cols:
            value = row_data[col]
            if col == 15:
                if value == &#34;pelagic&#34;:
                    value = 1
                elif value == &#34;benthic&#34;:
                    value = 0
                else:
                    raise ValueError(&#34;FeedingPath can only be pelagic or benthic.&#34;)
            label.append(value)
        label = torch.tensor(label)

        if self.transform:
            image = self.transform(image)

        return image, label, image_path

    def __len__(self) -&gt; int:
        return len(self.df)</code></pre>
</details>
<div class="desc"><p>A dataset for CV+ML that loads the required attribute labels.</p></div>
<h3>Ancestors</h3>
<ul class="hlist">
<li>torch.utils.data.dataset.Dataset</li>
<li>typing.Generic</li>
</ul>
</dd>
</dl>
</section>
</article>
<nav id="sidebar">
<div class="toc">
<ul>
<li><a href="#fishnet-fish-recognition-detection-and-functional-traits-prediction">FishNet: Fish Recognition, Detection, and Functional Traits Prediction</a></li>
</ul>
</div>
<ul id="index">
<li><h3>Super-module</h3>
<ul>
<li><code><a title="biobench" href="../index.html">biobench</a></code></li>
</ul>
</li>
<li><h3><a href="#header-submodules">Sub-modules</a></h3>
<ul>
<li><code><a title="biobench.fishnet.download" href="download.html">biobench.fishnet.download</a></code></li>
</ul>
</li>
<li><h3><a href="#header-functions">Functions</a></h3>
<ul class="">
<li><code><a title="biobench.fishnet.benchmark" href="#biobench.fishnet.benchmark">benchmark</a></code></li>
<li><code><a title="biobench.fishnet.calc_macro_f1" href="#biobench.fishnet.calc_macro_f1">calc_macro_f1</a></code></li>
<li><code><a title="biobench.fishnet.evaluate" href="#biobench.fishnet.evaluate">evaluate</a></code></li>
<li><code><a title="biobench.fishnet.get_features" href="#biobench.fishnet.get_features">get_features</a></code></li>
<li><code><a title="biobench.fishnet.init_classifier" href="#biobench.fishnet.init_classifier">init_classifier</a></code></li>
</ul>
</li>
<li><h3><a href="#header-classes">Classes</a></h3>
<ul>
<li>
<h4><code><a title="biobench.fishnet.Args" href="#biobench.fishnet.Args">Args</a></code></h4>
<ul class="two-column">
<li><code><a title="biobench.fishnet.Args.batch_size" href="#biobench.fishnet.Args.batch_size">batch_size</a></code></li>
<li><code><a title="biobench.fishnet.Args.data" href="#biobench.fishnet.Args.data">data</a></code></li>
<li><code><a title="biobench.fishnet.Args.debug" href="#biobench.fishnet.Args.debug">debug</a></code></li>
<li><code><a title="biobench.fishnet.Args.device" href="#biobench.fishnet.Args.device">device</a></code></li>
<li><code><a title="biobench.fishnet.Args.learning_rate" href="#biobench.fishnet.Args.learning_rate">learning_rate</a></code></li>
<li><code><a title="biobench.fishnet.Args.log_every" href="#biobench.fishnet.Args.log_every">log_every</a></code></li>
<li><code><a title="biobench.fishnet.Args.n_epochs" href="#biobench.fishnet.Args.n_epochs">n_epochs</a></code></li>
<li><code><a title="biobench.fishnet.Args.n_train" href="#biobench.fishnet.Args.n_train">n_train</a></code></li>
<li><code><a title="biobench.fishnet.Args.n_workers" href="#biobench.fishnet.Args.n_workers">n_workers</a></code></li>
<li><code><a title="biobench.fishnet.Args.seed" href="#biobench.fishnet.Args.seed">seed</a></code></li>
<li><code><a title="biobench.fishnet.Args.threshold" href="#biobench.fishnet.Args.threshold">threshold</a></code></li>
</ul>
</li>
<li>
<h4><code><a title="biobench.fishnet.Features" href="#biobench.fishnet.Features">Features</a></code></h4>
<ul class="">
<li><code><a title="biobench.fishnet.Features.dim" href="#biobench.fishnet.Features.dim">dim</a></code></li>
<li><code><a title="biobench.fishnet.Features.ids" href="#biobench.fishnet.Features.ids">ids</a></code></li>
<li><code><a title="biobench.fishnet.Features.x" href="#biobench.fishnet.Features.x">x</a></code></li>
<li><code><a title="biobench.fishnet.Features.y" href="#biobench.fishnet.Features.y">y</a></code></li>
</ul>
</li>
<li>
<h4><code><a title="biobench.fishnet.ImageDataset" href="#biobench.fishnet.ImageDataset">ImageDataset</a></code></h4>
</li>
</ul>
</li>
</ul>
</nav>
</main>
<footer id="footer">
<p>Generated by <a href="https://pdoc3.github.io/pdoc" title="pdoc: Python API documentation generator"><cite>pdoc</cite> 0.11.6</a>.</p>
</footer>
</body>
</html>
